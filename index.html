<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Pyramid Builder üìä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #f8f9fa;
            padding: 10px;
            line-height: 1.5;
            color: #042139;
            font-size: 16px;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
        }

        .container {
            max-width: 1400px;
            width: 95%;
            margin: 0 auto;
            background: #fff;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(4, 33, 57, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #042139 0%, #0a3855 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .header {
                padding: 30px;
            }
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            pointer-events: none;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.2em;
            }
        }

        .header p {
            opacity: 0.95;
            font-size: 0.9em;
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .header p {
                font-size: 1em;
            }
        }

        .summary-grid {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            border-bottom: 2px solid #042139;
        }

        @media (min-width: 768px) {
            .summary-grid {
                padding: 20px;
                gap: 20px;
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }

        @media (min-width: 1200px) {
            .summary-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .summary-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(4, 33, 57, 0.1);
            border-left: 4px solid #b70000;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(4, 33, 57, 0.15);
        }

        .summary-item .value {
            font-size: 1.6em;
            font-weight: bold;
            color: #000000;
            margin-bottom: 8px;
        }

        .summary-item .label {
            color: #042139;
            font-size: 0.95em;
            font-weight: 500;
        }

        .tabs {
            display: flex;
            background: #042139;
            overflow-x: auto;
            border-bottom: 3px solid #b70000;
        }

        .tab {
            padding: 18px 24px;
            background: #042139;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.95em;
            font-weight: 500;
            position: relative;
        }

        .tab:hover {
            background: rgba(183, 0, 0, 0.1);
            color: #febf1a;
        }

        .tab.active {
            background: #b70000;
            color: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #febf1a;
        }

        .tab.warning {
            position: relative;
        }

        .tab.warning::before {
            content: "‚ö†Ô∏è";
            margin-right: 5px;
            color: #febf1a;
        }

        .content {
            padding: 20px;
            min-height: 500px;
            background: white;
        }

        @media (min-width: 768px) {
            .content {
                padding: 35px;
            }
        }

        @media (min-width: 1200px) {
            .content {
                padding: 45px;
            }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #042139;
            font-size: 1.05em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #b70000;
            box-shadow: 0 0 0 3px rgba(183, 0, 0, 0.1);
        }

        .range-group {
            margin-bottom: 25px;
        }

        .range-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #042139 0%, #b70000 50%, #febf1a 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .range-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #b70000;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .range-group input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #b70000;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            color: #042139;
            font-weight: 500;
        }

        .btn {
            background: linear-gradient(135deg, #b70000 0%, #d10000 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(183, 0, 0, 0.2);
        }

        .btn:hover {
            background: linear-gradient(135deg, #a10000 0%, #b70000 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(183, 0, 0, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #042139 0%, #0a3855 100%);
            box-shadow: 0 2px 8px rgba(4, 33, 57, 0.2);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #031a2f 0%, #042139 100%);
            box-shadow: 0 4px 15px rgba(4, 33, 57, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #febf1a 0%, #feca3a 100%);
            color: #042139;
            box-shadow: 0 2px 8px rgba(254, 191, 26, 0.2);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #e5ab17 0%, #febf1a 100%);
            box-shadow: 0 4px 15px rgba(254, 191, 26, 0.3);
        }

        .pyramid {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 40px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
        }

        .pyramid-section {
            padding: 25px;
            color: white;
            font-weight: bold;
            text-align: center;
            border-radius: 8px;
            transition: all 0.4s ease;
            position: relative;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .pyramid-section.balanced {
            border: 2px solid transparent;
        }

        .pyramid-section.overweight {
            border: 4px dashed #febf1a;
            animation: pulse 2s infinite;
        }

        .pyramid-section.underweight {
            border: 4px dashed #b70000;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.02);
            }
            100% { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        .pyramid-section .section-name {
            font-size: 1.2em;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .pyramid-section .section-details {
            font-size: 0.9em;
            opacity: 0.95;
            line-height: 1.3;
        }

        .pyramid-section .status-badge {
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #febf1a;
            color: #042139;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .allocation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .allocation-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            border-left: 5px solid #b70000;
            box-shadow: 0 3px 12px rgba(4, 33, 57, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .allocation-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(4, 33, 57, 0.15);
        }

        .allocation-card h3 {
            color: #042139;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .allocation-card .percentage {
            font-size: 2.2em;
            font-weight: bold;
            color: #b70000;
            margin-bottom: 8px;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        @media (max-width: 767px) {
            .table-container {
                margin: 15px -10px;
                padding: 0 10px;
            }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 12px rgba(4, 33, 57, 0.1);
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            table {
                font-size: 1em;
            }
        }

        table th {
            background: linear-gradient(135deg, #042139 0%, #0a3855 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
            font-size: 0.85em;
        }

        @media (min-width: 768px) {
            table th {
                padding: 15px 12px;
                font-size: 0.95em;
            }
        }

        table td {
            padding: 12px 8px;
            border-bottom: 1px solid #e1e8ed;
            transition: background 0.2s ease;
        }

        @media (min-width: 768px) {
            table td {
                padding: 15px 12px;
            }
        }

        table tr:hover {
            background: #f8f9fa;
        }

        table tr:last-child td {
            border-bottom: none;
        }

        .stock-input {
            display: flex;
            gap: 15px;
            align-items: end;
            margin: 20px 0;
        }

        .stock-input input {
            flex: 1;
        }

        .stock-input .btn {
            padding: 12px 20px;
        }

        .alert {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff9e6 0%, #fef7e0 100%);
            border-left-color: #febf1a;
            color: #8b5a00;
        }

        .alert-success {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4f1d4 100%);
            border-left-color: #042139;
            color: #2d5a2d;
        }

        .alert-info {
            background: linear-gradient(135deg, #e6f2ff 0%, #d9ebff 100%);
            border-left-color: #042139;
            color: #1a4480;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e1e8ed;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(4, 33, 57, 0.05);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(4, 33, 57, 0.1);
        }

        .metric-card .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .metric-card .metric-label {
            color: #042139;
            font-size: 0.9em;
            font-weight: 500;
        }

        .metric-card.cash {
            border-left: 5px solid #b70000;
        }

        .metric-card.risk {
            border-left: 5px solid #042139;
        }

        .metric-card.balance {
            border-left: 5px solid #febf1a;
        }

        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        @media (max-width: 767px) {
            .container {
                margin: 5px;
                width: calc(100% - 10px);
            }
            
            .content {
                padding: 15px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 15px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 12px 16px;
                font-size: 0.9em;
            }
            
            .allocation-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
            }
            
            .pyramid {
                margin: 20px 0;
                padding: 15px;
            }
            
            .pyramid-section {
                padding: 15px;
                min-height: 70px;
            }
            
            .pyramid-section .section-name {
                font-size: 1em;
            }
            
            .pyramid-section .section-details {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Portfolio Pyramid Builder üìä</h1>
            <p>Professional portfolio allocation tool with systematic, age-based investment strategies</p>
        </div>

        <!-- Portfolio Summary -->
        <div id="portfolioSummary" class="summary-grid">
            <div class="summary-item">
                <div class="value" id="totalValue">$100,000</div>
                <div class="label">Total Portfolio Value</div>
            </div>
            <div class="summary-item">
                <div class="value" id="cashPosition">15.0%</div>
                <div class="label">Cash Position</div>
            </div>
            <div class="summary-item">
                <div class="value" id="largestHolding">Cash (15.0%)</div>
                <div class="label">Largest Holding</div>
            </div>
            <div class="summary-item">
                <div class="value" id="balanceStatus">Balanced</div>
                <div class="label">Portfolio Status</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('report')">üìã Report</button>
            <button class="tab" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab" onclick="showTab('staples')">üèõÔ∏è Staples</button>
            <button class="tab" onclick="showTab('matureGrowth')">üìà Mature Growth</button>
            <button class="tab" onclick="showTab('highGrowth')">üöÄ High Growth</button>
            <button class="tab" onclick="showTab('highRisk')">‚ö° High Risk</button>
        </div>

        <!-- Tab Content -->
        <div class="content">
            <!-- Age Selector (hidden on report) -->
            <div id="ageSelector" class="range-group hidden">
                <label>Your Age: <span id="ageDisplay">35 years</span></label>
                <input type="range" id="ageSlider" min="18" max="80" value="35" oninput="updateAge(this.value)">
                <div class="range-labels">
                    <span>18</span>
                    <span>80</span>
                </div>
            </div>

            <!-- Report Tab -->
            <div id="reportContent" class="tab-content">
                <div class="text-center mb-20">
                    <h2>Portfolio Allocation Report</h2>
                    <div id="clientNameDisplay" class="hidden">
                        <h3 style="color: #7f8c8d; margin: 10px 0;"></h3>
                    </div>
                    <p style="color: #7f8c8d;" id="reportDate"></p>
                    <p style="color: #3498db; font-weight: bold;" id="ageGroupDisplay">Age: 35 years (Mid-Career 35-54)</p>
                </div>

                <!-- Portfolio Overview Section -->
                <div class="alert alert-info">
                    <h3 style="margin-bottom: 15px;">Portfolio Overview</h3>
                    
                    <h4>Target Allocation (Age-Based)</h4>
                    <p style="margin-bottom: 15px;">Based on current age, the recommended target allocation is:</p>
                    <div class="allocation-grid" id="reportTargetCards"></div>
                    
                    <h4 style="margin-top: 25px;">Portfolio Analysis</h4>
                    <div id="reportAnalysisMessage" class="alert alert-success">
                        <p style="margin: 0; font-weight: bold;">Portfolio appears well-balanced for growth and stability</p>
                    </div>
                    
                    <div class="metrics-grid" id="reportAnalysisCards"></div>
                </div>

                <!-- Current Allocation Display -->
                <h3>Current Portfolio Allocation</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0;">
                    <div>
                        <h4 style="text-align: center; margin-bottom: 15px;">Current Allocation</h4>
                        <div id="reportCurrentAllocation"></div>
                    </div>
                    <div>
                        <h4 style="text-align: center; margin-bottom: 15px;">Portfolio Metrics</h4>
                        <div class="metrics-grid" id="reportPortfolioMetrics"></div>
                    </div>
                </div>

                <!-- Holdings Table -->
                <h3>Portfolio Holdings</h3>
                <div class="table-container">
                    <table id="reportHoldingsTable">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Asset/Stock</th>
                                <th style="text-align: center;">% of Portfolio</th>
                                <th style="text-align: center;">% of Category</th>
                            </tr>
                        </thead>
                        <tbody id="reportHoldingsBody"></tbody>
                    </table>
                </div>

                <!-- Pyramid Visualization -->
                <h3 style="text-align: center; margin: 30px 0 20px;">Portfolio Pyramid Visualization</h3>
                <div id="reportPyramid" class="pyramid"></div>
            </div>

            <!-- Overview Tab -->
            <div id="overviewContent" class="tab-content hidden">
                <div class="form-group">
                    <label for="clientNameInput">Client Name</label>
                    <input type="text" id="clientNameInput" placeholder="Enter client name for reports" onchange="updateClientName(this.value)">
                </div>

                <h3>Target Allocation (Age-Based)</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Based on your age, your target allocation is automatically set to:</p>
                <div class="allocation-grid" id="overviewTargetCards"></div>

                <div class="text-center mt-20">
                    <button class="btn" onclick="resetToRecommended()">Reset to Age-Based Recommendation</button>
                </div>

                <h3 style="margin-top: 30px;">Portfolio Pyramid</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Visual representation of your portfolio balance. 
                    <span style="color: #e74c3c;">Red dashed border</span> = Overweight (>5% above target) | 
                    <span style="color: #f39c12;">Orange dashed border</span> = Underweight (>5% below target)
                </p>
                <div id="overviewPyramid" class="pyramid"></div>

                <div id="rebalancingAlerts"></div>
            </div>

            <!-- Individual Category Tabs -->
            <div id="categoryContent" class="tab-content hidden">
                <div id="categoryHeader"></div>
                <div id="categoryDescription" class="alert alert-info"></div>
                <div id="categoryStocks"></div>
                <div id="addStockSection"></div>
                <div id="categoryTips"></div>
            </div>
        </div>
    </div>

    <script>
        // Portfolio State Management
        let portfolioState = {
            age: 35,
            clientName: '',
            currentTab: 'report',
            targetAllocations: { staples: 40, matureGrowth: 25, highGrowth: 25, highRisk: 10 },
            actualAllocations: { staples: 40, matureGrowth: 25, highGrowth: 25, highRisk: 10 },
            categoryStocks: {
                staples: [
                    { name: 'Cash', dollars: 15000, id: 'staples-1' },
                    { name: 'Gold ETF (GLD)', dollars: 5000, id: 'staples-2' },
                    { name: 'Johnson & Johnson (JNJ)', dollars: 10000, id: 'staples-3' },
                    { name: 'Procter & Gamble (PG)', dollars: 10000, id: 'staples-4' }
                ],
                matureGrowth: [
                    { name: 'Microsoft (MSFT)', dollars: 12500, id: 'mature-1' },
                    { name: 'Apple (AAPL)', dollars: 7500, id: 'mature-2' },
                    { name: 'Visa (V)', dollars: 5000, id: 'mature-3' }
                ],
                highGrowth: [
                    { name: 'Salesforce (CRM)', dollars: 10000, id: 'highgrowth-1' },
                    { name: 'Adobe (ADBE)', dollars: 8000, id: 'highgrowth-2' },
                    { name: 'CrowdStrike (CRWD)', dollars: 7000, id: 'highgrowth-3' }
                ],
                highRisk: [
                    { name: 'Cloudflare (NET)', dollars: 5000, id: 'highrisk-1' },
                    { name: 'CRISPR (CRSP)', dollars: 5000, id: 'highrisk-2' }
                ]
            }
        };

        const categories = [
            { 
                id: 'staples', 
                name: 'Staples', 
                icon: 'üèõÔ∏è',
                color: '#2c3e50',
                description: 'Consumer staples, healthcare, utilities, cash, gold, ETFs',
                examples: ['Cash', 'Gold ETF (GLD)', 'Johnson & Johnson (JNJ)', 'Procter & Gamble (PG)', 'Walmart (WMT)'],
                tips: [
                    'Cash is crucial for emergencies and buying opportunities - aim for 10-15% of your portfolio',
                    'Look for consistent dividend payers with long histories of increases', 
                    'Consider defensive sectors like utilities, consumer staples, and healthcare',
                    'Gold can serve as inflation protection and portfolio insurance',
                    'Short-term treasury bills (6-month to 2-year) offer attractive yields with minimal risk'
                ]
            },
            { 
                id: 'matureGrowth', 
                name: 'Mature Growth', 
                icon: 'üìà',
                color: '#27ae60',
                description: 'Companies with 5-12% revenue growth',
                examples: ['Microsoft (MSFT)', 'Apple (AAPL)', 'Visa (V)', 'Home Depot (HD)', 'UnitedHealth (UNH)'],
                tips: [
                    'Focus on established companies with strong competitive advantages',
                    'Look for consistent revenue growth between 5-12% annually',
                    'Prioritize companies with solid free cash flow generation',
                    'Favor businesses with pricing power that can weather inflationary environments',
                    'Consider dividend-growth companies that increase payouts consistently'
                ]
            },
            { 
                id: 'highGrowth', 
                name: 'High Growth', 
                icon: 'üöÄ',
                color: '#f39c12',
                description: 'Companies with 12-24% revenue growth',
                examples: ['Salesforce (CRM)', 'Adobe (ADBE)', 'CrowdStrike (CRWD)', 'Palo Alto Networks (PANW)'],
                tips: [
                    'Target companies growing revenues at 12-24% annually',
                    'Look for expanding market share in growing industries',
                    'Assess path to profitability for companies not yet profitable',
                    'Monitor quarterly growth rates for any concerning deceleration',
                    'Consider sector leaders with competitive advantages and differentiation'
                ]
            },
            { 
                id: 'highRisk', 
                name: 'High Risk', 
                icon: '‚ö°',
                color: '#e74c3c',
                description: 'Companies with >25% growth and high volatility',
                examples: ['Cloudflare (NET)', 'CRISPR (CRSP)', 'Robinhood (HOOD)', 'Hims & Hers (HIMS)'],
                tips: [
                    'Limit this category based on your age and risk tolerance',
                    'Only invest what you can afford to lose completely',
                    'Look for disruptive businesses addressing large market opportunities',
                    'Consider dollar-cost averaging into positions rather than lump sums',
                    'Set stop-losses or maximum drawdown limits to protect capital',
                    'Remember: If these stocks 10x, they can significantly boost portfolio returns'
                ]
            }
        ];

        // Utility Functions
        function formatDollars(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 0
            }).format(amount);
        }

        function calculateTotalValue() {
            let total = 0;
            Object.values(portfolioState.categoryStocks).forEach(stocks => {
                stocks.forEach(stock => total += stock.dollars);
            });
            return total;
        }

        function calculateCategoryTotal(categoryId) {
            return portfolioState.categoryStocks[categoryId].reduce((sum, stock) => sum + stock.dollars, 0);
        }

        function updateActualAllocations() {
            const total = calculateTotalValue();
            if (total > 0) {
                Object.keys(portfolioState.categoryStocks).forEach(category => {
                    const categoryTotal = calculateCategoryTotal(category);
                    portfolioState.actualAllocations[category] = parseFloat(((categoryTotal / total) * 100).toFixed(1));
                });
            }
        }

        function updateTargetAllocations() {
            const age = portfolioState.age;
            if (age < 35) {
                portfolioState.targetAllocations = { staples: 35, matureGrowth: 20, highGrowth: 25, highRisk: 20 };
            } else if (age < 55) {
                portfolioState.targetAllocations = { staples: 40, matureGrowth: 25, highGrowth: 25, highRisk: 10 };
            } else {
                portfolioState.targetAllocations = { staples: 40, matureGrowth: 30, highGrowth: 25, highRisk: 5 };
            }
        }

        function getCashPercentage() {
            const total = calculateTotalValue();
            const cashStock = portfolioState.categoryStocks.staples.find(stock => stock.name === 'Cash');
            return cashStock && total > 0 ? (cashStock.dollars / total) * 100 : 0;
        }

        function getLargestHolding() {
            const total = calculateTotalValue();
            let largest = { name: '', percentage: 0 };
            
            Object.values(portfolioState.categoryStocks).forEach(stocks => {
                stocks.forEach(stock => {
                    const percentage = total > 0 ? (stock.dollars / total) * 100 : 0;
                    if (percentage > largest.percentage) {
                        largest = { name: stock.name, percentage };
                    }
                });
            });
            
            return largest;
        }

        function getOutOfBalanceCategories() {
            const outOfBalance = [];
            Object.keys(portfolioState.actualAllocations).forEach(category => {
                const difference = portfolioState.actualAllocations[category] - portfolioState.targetAllocations[category];
                if (Math.abs(difference) > 5) {
                    const categoryData = categories.find(c => c.id === category);
                    outOfBalance.push({
                        category: categoryData.name,
                        status: difference > 5 ? 'overweight' : 'underweight',
                        actual: portfolioState.actualAllocations[category],
                        target: portfolioState.targetAllocations[category],
                        difference: difference
                    });
                }
            });
            return outOfBalance;
        }

        function getCategoryStatus(categoryId) {
            const difference = portfolioState.actualAllocations[categoryId] - portfolioState.targetAllocations[categoryId];
            if (Math.abs(difference) <= 5) return 'balanced';
            return difference > 5 ? 'overweight' : 'underweight';
        }

        function getRiskProfile() {
            const { matureGrowth, highGrowth, highRisk } = portfolioState.actualAllocations;
            const growthPotential = (matureGrowth * 0.1) + (highGrowth * 0.2) + (highRisk * 0.4);
            if (growthPotential < 15) return "Conservative";
            if (growthPotential < 20) return "Moderate";
            if (growthPotential < 25) return "Growth-Oriented";
            return "Aggressive Growth";
        }

        function getBalanceScore() {
            const outOfBalanceCount = getOutOfBalanceCategories().length;
            if (outOfBalanceCount === 0) return "Excellent";
            if (outOfBalanceCount === 1) return "Good";
            if (outOfBalanceCount === 2) return "Needs Attention";
            return "Requires Rebalancing";
        }

        // UI Update Functions
        function updatePortfolioSummary() {
            const total = calculateTotalValue();
            const cashPercentage = getCashPercentage();
            const largest = getLargestHolding();
            const balanceScore = getBalanceScore();

            document.getElementById('totalValue').textContent = formatDollars(total);
            document.getElementById('cashPosition').textContent = cashPercentage.toFixed(1) + '%';
            document.getElementById('largestHolding').textContent = `${largest.name} (${largest.percentage.toFixed(1)}%)`;
            document.getElementById('balanceStatus').textContent = balanceScore;
        }

        function updateTabWarnings() {
            const outOfBalance = getOutOfBalanceCategories();
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => {
                tab.classList.remove('warning');
                const tabText = tab.textContent.toLowerCase();
                
                outOfBalance.forEach(item => {
                    if (tabText.includes(item.category.toLowerCase().replace(' ', ''))) {
                        tab.classList.add('warning');
                    }
                });
            });
        }

        function createPyramidVisualization(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const pyramidData = [
                { 
                    id: 'highRisk', 
                    name: 'High Risk', 
                    target: portfolioState.targetAllocations.highRisk, 
                    actual: portfolioState.actualAllocations.highRisk, 
                    color: '#e74c3c', 
                    width: Math.max(20, Math.min(80, portfolioState.actualAllocations.highRisk * 2))
                },
                { 
                    id: 'highGrowth', 
                    name: 'High Growth', 
                    target: portfolioState.targetAllocations.highGrowth, 
                    actual: portfolioState.actualAllocations.highGrowth, 
                    color: '#f39c12', 
                    width: Math.max(30, Math.min(90, portfolioState.actualAllocations.highGrowth * 2))
                },
                { 
                    id: 'matureGrowth', 
                    name: 'Mature Growth', 
                    target: portfolioState.targetAllocations.matureGrowth, 
                    actual: portfolioState.actualAllocations.matureGrowth, 
                    color: '#27ae60', 
                    width: Math.max(40, Math.min(95, portfolioState.actualAllocations.matureGrowth * 2.5))
                },
                { 
                    id: 'staples', 
                    name: 'Staples', 
                    target: portfolioState.targetAllocations.staples, 
                    actual: portfolioState.actualAllocations.staples, 
                    color: '#2c3e50', 
                    width: Math.max(50, Math.min(100, portfolioState.actualAllocations.staples * 1.5))
                }
            ];

            pyramidData.forEach(section => {
                const status = getCategoryStatus(section.id);
                
                const sectionDiv = document.createElement('div');
                sectionDiv.className = `pyramid-section ${status}`;
                sectionDiv.style.backgroundColor = section.color;
                sectionDiv.style.width = section.width + '%';
                
                let statusBadge = '';
                if (status !== 'balanced') {
                    statusBadge = `<div class="status-badge">${status === 'overweight' ? 'OVER' : 'UNDER'}</div>`;
                }
                
                sectionDiv.innerHTML = `
                    <div class="section-name">${section.name}</div>
                    <div class="section-details">
                        Target: ${section.target}% | Actual: ${section.actual}%
                    </div>
                    ${section.id === 'staples' ? `<div style="font-size: 0.8em; margin-top: 5px;">Cash: ${getCashPercentage().toFixed(1)}% of portfolio</div>` : ''}
                    ${statusBadge}
                `;
                
                container.appendChild(sectionDiv);
            });
        }

        function updateReportContent() {
            // Update header info
            document.getElementById('reportDate').textContent = 'Generated on ' + new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const ageGroup = portfolioState.age < 35 ? "Young Investor (18-34)" : 
                             portfolioState.age < 55 ? "Mid-Career (35-54)" : "Pre-Retirement (55+)";
            document.getElementById('ageGroupDisplay').textContent = `Age: ${portfolioState.age} years (${ageGroup})`;
            
            // Update client name
            const clientDisplay = document.getElementById('clientNameDisplay');
            if (portfolioState.clientName) {
                clientDisplay.querySelector('h3').textContent = `Client: ${portfolioState.clientName}`;
                clientDisplay.classList.remove('hidden');
            } else {
                clientDisplay.classList.add('hidden');
            }

            // Update target allocation cards
            const targetContainer = document.getElementById('reportTargetCards');
            targetContainer.innerHTML = '';
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'allocation-card';
                card.style.borderLeftColor = category.color;
                card.innerHTML = `
                    <h3>${category.name}</h3>
                    <div class="percentage" style="color: ${category.color};">
                        ${portfolioState.targetAllocations[category.id]}%
                    </div>
                `;
                targetContainer.appendChild(card);
            });

            // Update analysis cards
            const analysisContainer = document.getElementById('reportAnalysisCards');
            const cashPercentage = getCashPercentage();
            const riskProfile = getRiskProfile();
            const balanceScore = getBalanceScore();
            
            analysisContainer.innerHTML = `
                <div class="metric-card cash">
                    <div class="metric-value" style="color: #3498db;">${cashPercentage.toFixed(1)}%</div>
                    <div class="metric-label">Cash Position</div>
                </div>
                <div class="metric-card risk">
                    <div class="metric-value" style="color: #27ae60;">${riskProfile}</div>
                    <div class="metric-label">Risk Profile</div>
                </div>
                <div class="metric-card balance">
                    <div class="metric-value" style="color: #9b59b6;">${balanceScore}</div>
                    <div class="metric-label">Balance Score</div>
                </div>
            `;

            // Update current allocation list
            const currentContainer = document.getElementById('reportCurrentAllocation');
            currentContainer.innerHTML = '';
            categories.forEach(category => {
                const difference = portfolioState.actualAllocations[category.id] - portfolioState.targetAllocations[category.id];
                const status = getCategoryStatus(category.id);
                
                const item = document.createElement('div');
                item.style.display = 'flex';
                item.style.alignItems = 'center';
                item.style.marginBottom = '10px';
                item.innerHTML = `
                    <div style="width: 15px; height: 15px; background-color: ${category.color}; border-radius: 3px; margin-right: 10px;"></div>
                    <div style="flex: 1; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold;">${category.name}</span>
                        <div style="display: flex; align-items: center;">
                            <span style="font-weight: bold; margin-right: 10px;">${portfolioState.actualAllocations[category.id]}%</span>
                            ${status !== 'balanced' ? `<span style="font-size: 0.8em; padding: 2px 6px; border-radius: 10px; ${status === 'overweight' ? 'background: #ffebee; color: #c62828;' : 'background: #fff8e1; color: #ef6c00;'}">${difference > 0 ? '+' : ''}${difference.toFixed(1)}%</span>` : ''}
                        </div>
                    </div>
                `;
                currentContainer.appendChild(item);
            });

            // Update portfolio metrics
            updatePortfolioMetrics();
            
            // Update holdings table
            updateHoldingsTable();
            
            // Update pyramid
            createPyramidVisualization('reportPyramid');
        }

        function updatePortfolioMetrics() {
            const metricsContainer = document.getElementById('reportPortfolioMetrics');
            const cashPercentage = getCashPercentage();
            const riskProfile = getRiskProfile();
            const balanceScore = getBalanceScore();
            
            metricsContainer.innerHTML = `
                <div class="metric-card cash">
                    <div class="metric-value" style="color: #3498db;">${cashPercentage.toFixed(1)}%</div>
                    <div class="metric-label">Cash Position</div>
                </div>
                <div class="metric-card risk">
                    <div class="metric-value" style="color: #27ae60;">${riskProfile}</div>
                    <div class="metric-label">Risk Profile</div>
                </div>
                <div class="metric-card balance">
                    <div class="metric-value" style="color: #9b59b6;">${balanceScore}</div>
                    <div class="metric-label">Balance Score</div>
                </div>
            `;
        }

        function updateHoldingsTable() {
            const tbody = document.getElementById('reportHoldingsBody');
            tbody.innerHTML = '';
            
            const total = calculateTotalValue();
            
            categories.forEach(category => {
                const categoryTotal = calculateCategoryTotal(category.id);
                const stocks = portfolioState.categoryStocks[category.id];
                
                stocks.forEach((stock, index) => {
                    const percentOfPortfolio = total > 0 ? (stock.dollars / total) * 100 : 0;
                    const percentOfCategory = categoryTotal > 0 ? (stock.dollars / categoryTotal) * 100 : 0;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            ${index === 0 ? `
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 12px; height: 12px; background-color: ${category.color}; border-radius: 2px; margin-right: 8px;"></div>
                                    <span style="font-weight: bold;">${category.name}</span>
                                </div>
                            ` : ''}
                        </td>
                        <td>
                            ${stock.name}
                            ${category.id === 'staples' && stock.name === 'Cash' ? '<span style="color: #3498db; font-size: 0.8em; margin-left: 8px;">(Emergency Fund)</span>' : ''}
                        </td>
                        <td style="text-align: center; font-weight: bold;">${percentOfPortfolio.toFixed(1)}%</td>
                        <td style="text-align: center;">${percentOfCategory.toFixed(1)}%</td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add category total row
                const totalRow = document.createElement('tr');
                totalRow.style.backgroundColor = '#f8f9fa';
                totalRow.style.fontWeight = 'bold';
                totalRow.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 12px; height: 12px; background-color: ${category.color}; border-radius: 2px; margin-right: 8px;"></div>
                            <span>${category.name} Total</span>
                        </div>
                    </td>
                    <td>‚Äî</td>
                    <td style="text-align: center;">${portfolioState.actualAllocations[category.id]}%</td>
                    <td style="text-align: center;">100%</td>
                `;
                tbody.appendChild(totalRow);
            });
        }

        function updateOverviewContent() {
            // Update target cards
            const overviewContainer = document.getElementById('overviewTargetCards');
            overviewContainer.innerHTML = '';
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'allocation-card';
                card.style.borderLeftColor = category.color;
                card.innerHTML = `
                    <h3>${category.name}</h3>
                    <div class="percentage" style="color: ${category.color};">
                        ${portfolioState.targetAllocations[category.id]}%
                    </div>
                `;
                overviewContainer.appendChild(card);
            });
            
            // Update pyramid
            createPyramidVisualization('overviewPyramid');
            
            // Update rebalancing alerts
            updateRebalancingAlerts();
        }

        function updateRebalancingAlerts() {
            const alertsContainer = document.getElementById('rebalancingAlerts');
            const outOfBalance = getOutOfBalanceCategories();
            
            if (outOfBalance.length > 0) {
                alertsContainer.innerHTML = `
                    <div class="alert alert-warning">
                        <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Rebalancing Needed</h3>
                        <p style="margin-bottom: 15px;">These categories are more than 5% away from your target allocation:</p>
                        ${outOfBalance.map(item => `
                            <div style="background: white; padding: 10px; border-radius: 4px; margin-bottom: 10px; display: flex; justify-content: space-between;">
                                <div>
                                    <span style="font-weight: bold;">${item.category}</span>
                                    <span style="color: #7f8c8d; margin-left: 8px;">(${item.status === 'overweight' ? 'Overweight' : 'Underweight'})</span>
                                </div>
                                <div>
                                    <span style="font-size: 0.9em;">
                                        Current: ${item.actual}% | Target: ${item.target}% | 
                                        <span style="color: ${item.difference > 0 ? '#e74c3c' : '#3498db'}; font-weight: bold;">
                                            ${item.difference > 0 ? '+' : ''}${item.difference.toFixed(1)}%
                                        </span>
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                        <p style="margin-top: 15px; color: #7f8c8d; font-size: 0.9em;">
                            To rebalance, click on each category tab above to adjust your individual holdings.
                        </p>
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = `
                    <div class="alert alert-success">
                        <h3 style="margin-bottom: 10px;">‚úÖ Portfolio Well Balanced</h3>
                        <p style="margin: 0;">All categories are within ¬±5% of their target allocations. No immediate rebalancing required.</p>
                    </div>
                `;
            }
        }

        function updateCategoryContent(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            const categoryTotal = calculateCategoryTotal(categoryId);
            const status = getCategoryStatus(categoryId);
            const total = calculateTotalValue();

            // Update header
            document.getElementById('categoryHeader').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                    <div>
                        <h2>${category.icon} ${category.name} 
                            <span style="color: #7f8c8d; font-weight: normal; font-size: 0.8em;">
                                (${portfolioState.actualAllocations[categoryId]}% of portfolio)
                            </span>
                        </h2>
                        <p style="color: #7f8c8d; margin: 5px 0;">
                            Target: ${portfolioState.targetAllocations[categoryId]}% 
                            <span style="margin-left: 10px; font-weight: bold; ${status === 'balanced' ? 'color: #27ae60;' : status === 'overweight' ? 'color: #e74c3c;' : 'color: #f39c12;'}">
                                ${status === 'balanced' ? '(On Target)' : 
                                  status === 'overweight' ? `(Overweight by ${(portfolioState.actualAllocations[categoryId] - portfolioState.targetAllocations[categoryId]).toFixed(1)}%)` :
                                  `(Underweight by ${(portfolioState.targetAllocations[categoryId] - portfolioState.actualAllocations[categoryId]).toFixed(1)}%)`}
                            </span>
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5em; font-weight: bold; color: ${category.color};">${formatDollars(categoryTotal)}</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">Total Value</div>
                    </div>
                </div>
            `;

            // Update description
            document.getElementById('categoryDescription').innerHTML = `
                <p style="margin-bottom: 15px;">${category.description}</p>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    ${category.examples.map(example => `
                        <span style="background: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; border: 1px solid #ecf0f1;">
                            ${example}
                        </span>
                    `).join('')}
                </div>
            `;

            // Update stocks table
            const stocks = portfolioState.categoryStocks[categoryId];
            document.getElementById('categoryStocks').innerHTML = `
                <h3>Your ${category.name} Holdings</h3>
                <div class="table-container">
                    <table style="margin-bottom: 30px;">
                        <thead>
                            <tr>
                                <th>Stock/Asset</th>
                                <th style="text-align: center;">Dollar Value</th>
                                <th style="text-align: center;">% of ${category.name}</th>
                                <th style="text-align: center;">% of Portfolio</th>
                                <th style="text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${stocks.length === 0 ? 
                                '<tr><td colspan="5" style="text-align: center; color: #7f8c8d; padding: 20px;">No stocks added yet. Add your first stock below.</td></tr>' :
                                stocks.map(stock => {
                                    const percentOfCategory = categoryTotal > 0 ? (stock.dollars / categoryTotal) * 100 : 0;
                                    const percentOfPortfolio = total > 0 ? (stock.dollars / total) * 100 : 0;
                                    
                                    return `
                                        <tr>
                                            <td>
                                                ${stock.name}
                                                ${categoryId === 'staples' && stock.name === 'Cash' ? 
                                                    '<span style="color: #3498db; font-size: 0.8em; margin-left: 8px;">(Recommended: 10-15% of portfolio)</span>' : ''}
                                            </td>
                                            <td style="text-align: center;">
                                                <input type="number" value="${stock.dollars}" min="0" step="1000" 
                                                       style="width: 120px; text-align: center;" 
                                                       onchange="updateStockDollars('${categoryId}', '${stock.id}', this.value)">
                                            </td>
                                            <td style="text-align: center;">${percentOfCategory.toFixed(1)}%</td>
                                            <td style="text-align: center; font-weight: bold;">${percentOfPortfolio.toFixed(1)}%</td>
                                            <td style="text-align: center;">
                                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8em;" 
                                                        onclick="removeStock('${categoryId}', '${stock.id}')">Remove</button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')
                            }
                            <tr style="background: #f8f9fa; font-weight: bold;">
                                <td>Total</td>
                                <td style="text-align: center;">${formatDollars(categoryTotal)}</td>
                                <td style="text-align: center;">100%</td>
                                <td style="text-align: center;">${portfolioState.actualAllocations[categoryId]}%</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;

            // Update add stock section
            document.getElementById('addStockSection').innerHTML = `
                <div class="alert alert-info">
                    <h4 style="margin-bottom: 15px;">Add New Stock/Asset</h4>
                    <div class="stock-input">
                        <div style="flex: 2;">
                            <label>Name/Ticker</label>
                            <input type="text" id="newStockName" placeholder="e.g. Apple (AAPL)" style="margin-top: 5px;">
                        </div>
                        <div style="flex: 1;">
                            <label>Dollar Value</label>
                            <input type="number" id="newStockDollars" min="1000" step="1000" value="5000" style="margin-top: 5px;">
                        </div>
                        <button class="btn btn-success" onclick="addStock('${categoryId}')">Add Stock</button>
                    </div>
                </div>
            `;

            // Update rebalancing recommendations
            if (status !== 'balanced') {
                const difference = portfolioState.actualAllocations[categoryId] - portfolioState.targetAllocations[categoryId];
                const isOverweight = status === 'overweight';
                
                document.getElementById('addStockSection').innerHTML += `
                    <div class="alert ${isOverweight ? 'alert-warning' : 'alert-info'}" style="margin-top: 20px;">
                        <h4 style="margin-bottom: 15px; color: ${isOverweight ? '#856404' : '#0c5460'};">
                            Rebalancing Recommendations
                        </h4>
                        ${isOverweight ? `
                            <p style="margin-bottom: 15px;">This category is overweight by ${Math.abs(difference).toFixed(1)}% compared to your target. To rebalance:</p>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>Consider reducing position sizes in this category</li>
                                <li>Sell approximately ${formatDollars(Math.abs(difference) * total / 100)} of assets from this category</li>
                                <li>Reinvest the proceeds in underweight categories</li>
                            </ul>
                        ` : `
                            <p style="margin-bottom: 15px;">This category is underweight by ${Math.abs(difference).toFixed(1)}% compared to your target. To rebalance:</p>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>Consider increasing position sizes in this category</li>
                                <li>Add approximately ${formatDollars(Math.abs(difference) * total / 100)} to assets in this category</li>
                                <li>Fund this by reducing overweight categories</li>
                            </ul>
                        `}
                    </div>
                `;
            }

            // Update tips
            document.getElementById('categoryTips').innerHTML = `
                <div class="alert alert-success" style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">üí° Tips for ${category.name}</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        ${category.tips.map(tip => `<li style="margin-bottom: 8px;">${tip}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // Event Handlers
        function showTab(tabName) {
            // Update current tab
            portfolioState.currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show/hide age selector and portfolio summary
            const ageSelector = document.getElementById('ageSelector');
            const portfolioSummary = document.getElementById('portfolioSummary');
            
            if (tabName === 'report') {
                ageSelector.classList.add('hidden');
                portfolioSummary.classList.add('hidden');
                document.getElementById('reportContent').classList.remove('hidden');
                updateReportContent();
            } else if (tabName === 'overview') {
                ageSelector.classList.remove('hidden');
                portfolioSummary.classList.remove('hidden');
                document.getElementById('overviewContent').classList.remove('hidden');
                updateOverviewContent();
            } else {
                ageSelector.classList.remove('hidden');
                portfolioSummary.classList.remove('hidden');
                document.getElementById('categoryContent').classList.remove('hidden');
                updateCategoryContent(tabName);
            }
        }

        function updateAge(newAge) {
            portfolioState.age = parseInt(newAge);
            document.getElementById('ageDisplay').textContent = newAge + ' years';
            updateTargetAllocations();
            updateActualAllocations();
            updatePortfolioSummary();
            updateTabWarnings();
            
            if (portfolioState.currentTab === 'report') {
                updateReportContent();
            } else if (portfolioState.currentTab === 'overview') {
                updateOverviewContent();
            }
        }

        function updateClientName(name) {
            portfolioState.clientName = name;
            if (portfolioState.currentTab === 'report') {
                updateReportContent();
            }
        }

        function resetToRecommended() {
            portfolioState.categoryStocks = {
                staples: [
                    { name: 'Cash', dollars: 40000, id: 'staples-1' },
                    { name: 'Gold ETF (GLD)', dollars: 20000, id: 'staples-2' },
                    { name: 'Johnson & Johnson (JNJ)', dollars: 20000, id: 'staples-3' },
                    { name: 'Procter & Gamble (PG)', dollars: 20000, id: 'staples-4' }
                ],
                matureGrowth: [
                    { name: 'Microsoft (MSFT)', dollars: 12500, id: 'mature-1' },
                    { name: 'Apple (AAPL)', dollars: 12500, id: 'mature-2' },
                    { name: 'Visa (V)', dollars: 12500, id: 'mature-3' },
                    { name: 'Home Depot (HD)', dollars: 12500, id: 'mature-4' }
                ],
                highGrowth: [
                    { name: 'Salesforce (CRM)', dollars: 12500, id: 'highgrowth-1' },
                    { name: 'Adobe (ADBE)', dollars: 12500, id: 'highgrowth-2' },
                    { name: 'CrowdStrike (CRWD)', dollars: 12500, id: 'highgrowth-3' },
                    { name: 'Palo Alto Networks (PANW)', dollars: 12500, id: 'highgrowth-4' }
                ],
                highRisk: [
                    { name: 'Cloudflare (NET)', dollars: 10000, id: 'highrisk-1' },
                    { name: 'CRISPR (CRSP)', dollars: 10000, id: 'highrisk-2' }
                ]
            };
            
            updateActualAllocations();
            updatePortfolioSummary();
            updateTabWarnings();
            
            if (portfolioState.currentTab === 'report') {
                updateReportContent();
            } else if (portfolioState.currentTab === 'overview') {
                updateOverviewContent();
            }
        }

        function updateStockDollars(categoryId, stockId, newAmount) {
            const stocks = portfolioState.categoryStocks[categoryId];
            const stock = stocks.find(s => s.id === stockId);
            if (stock) {
                stock.dollars = parseInt(newAmount) || 0;
                updateActualAllocations();
                updatePortfolioSummary();
                updateTabWarnings();
                
                if (portfolioState.currentTab === categoryId) {
                    updateCategoryContent(categoryId);
                }
            }
        }

        function removeStock(categoryId, stockId) {
            portfolioState.categoryStocks[categoryId] = portfolioState.categoryStocks[categoryId].filter(s => s.id !== stockId);
            updateActualAllocations();
            updatePortfolioSummary();
            updateTabWarnings();
            updateCategoryContent(categoryId);
        }

        function addStock(categoryId) {
            const nameInput = document.getElementById('newStockName');
            const dollarsInput = document.getElementById('newStockDollars');
            
            const name = nameInput.value.trim();
            const dollars = parseInt(dollarsInput.value) || 0;
            
            if (name && dollars > 0) {
                const newStock = {
                    name: name,
                    dollars: dollars,
                    id: `${categoryId}-${Date.now()}`
                };
                
                portfolioState.categoryStocks[categoryId].push(newStock);
                
                // Clear inputs
                nameInput.value = '';
                dollarsInput.value = '5000';
                
                updateActualAllocations();
                updatePortfolioSummary();
                updateTabWarnings();
                updateCategoryContent(categoryId);
            }
        }

        // Initialize the application
        function init() {
            updateTargetAllocations();
            updateActualAllocations();
            updatePortfolioSummary();
            updateTabWarnings();
            updateReportContent();
        }

        // Start the application
        window.onload = init;
    </script>
</body>
</html>
